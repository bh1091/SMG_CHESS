package org.zhaohuizhang.hw3;

import org.zhaohuizhang.hw6.client.ChessGameService;
import org.zhaohuizhang.hw6.client.ChessGameServiceAsync;
import org.zhaohuizhang.hw6.client.LoginInfo;

import com.google.gwt.core.client.EntryPoint;
import com.google.gwt.core.client.GWT;
import com.google.gwt.user.client.rpc.AsyncCallback;
import com.google.gwt.user.client.ui.Anchor;
import com.google.gwt.user.client.ui.Label;
import com.google.gwt.user.client.ui.RootPanel;
import com.google.gwt.user.client.ui.VerticalPanel;

public class ChessEntryPoint implements EntryPoint {

	private LoginInfo loginInfo = null;
	private VerticalPanel loginPanel = new VerticalPanel();
	private Label loginLabel = new Label(
			"Please sign in to your Google Account to access the Online-Chess application.");
	private Label greeting;
	private Anchor signInLink = new Anchor("Log In");
	private Anchor signOutLink = new Anchor("Log Out");

	public void onModuleLoad() {
		// Check login status using login service.
		ChessGameServiceAsync loginService = GWT.create(ChessGameService.class);
		loginService.login(GWT.getHostPageBaseURL() + "zhaohuizhang.html",
				new AsyncCallback<LoginInfo>() {
					public void onFailure(Throwable error) {
					}

					public void onSuccess(LoginInfo result) {
						loginInfo = result;
						if (loginInfo.isLoggedIn()) {
							loadChessGame();
						} else {
							loadLogin();
						}
					}
				});

	}

	public void loadChessGame() {
		final Graphics graphics = new Graphics();
		greeting = new Label("Player Name: " + loginInfo.getNickname()
				+ " Player Email: " + loginInfo.getEmailAddress());
		signOutLink.setHref(loginInfo.getLogoutUrl());
		Presenter presenter = new Presenter();
		presenter.initView(graphics);
		RootPanel.get().add(greeting);
		RootPanel.get().add(signOutLink);
		RootPanel.get().add(graphics);
	}

	public void loadLogin() {
		// Assemble login panel.
		signInLink.setHref(loginInfo.getLoginUrl());
		loginPanel.add(loginLabel);
		loginPanel.add(signInLink);
		RootPanel.get().add(loginPanel);
	}
}
